import React, { useState } from "react";
import classes from "./Form.module.scss";
import { loginUser, saveLoggedInUser } from "../../utils/AuthService";
import { NavLink, useNavigate } from "react-router-dom";

const LoginForm: React.FC = () => {

  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const [error, setError] = useState<string>("");
  const [loading, setLoading] = useState<boolean>(false);

  const navigate = useNavigate();

  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {
    event.preventDefault();

    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      setError("Наданий Вами електронний адрес має неправильний формат!");
      return;
    }

    if (password.length < 5) {
      setError("Пароль повинен бути не меньше 5 символів!");
      return;
    }

    try {
      const userData = {
        email,
        password,
      };

      setLoading(true);
      const response = await loginUser(userData);

      if (response) {
        saveLoggedInUser(email, response.role, response.firstName, response.lastName, response.phoneNumber);
        navigate("/");
      } else {
        setError("Електронна адреса або пароль невірні!");
      }
    } catch (error) {
      console.error(error);
      setError("Електронна адреса або пароль невірні!");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className={classes["login-form"]}>

      <form className={classes["form"]} onSubmit={handleSubmit}>
        {loading && <div>Loading...</div>}
        {error && <div className={classes["error"]}>{error}</div>}

        <div className={classes["input-container"]}>

          <input
            className={classes["input-field"]}
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="Пошта"
            required
          />
        </div>
        <div className={classes["input-container"]}>
          <input
            className={classes["input-field"]}
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            placeholder="Пароль"
            required
          />
        </div>
        <button type="submit" className={classes["login-button"]}>
          Увійти
        </button>
      </form>
      <p className={classes["forgot-password"]}>
        <a href="">Забули пароль?</a>
      </p>
      <div className={classes["or"]}>
        <h2>
          <span>або</span>
        </h2>
      </div>
      <div className={classes["buttons-section"]}>

        <button>
          <svg width="165" height="63" viewBox="0 0 165 63" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.899994 9.60548C0.899994 5.1872 4.48172 1.60547 8.89999 1.60547H156.1C160.518 1.60547 164.1 5.18719 164.1 9.60547V53.9222C164.1 58.3404 160.518 61.9222 156.1 61.9222H8.89999C4.48171 61.9222 0.899994 58.3405 0.899994 53.9222V9.60548Z" fill="white" stroke="#E0E2E9" stroke-width="1.60375" />
            <path d="M78.27 26.5391C78.046 26.1284 77.738 25.8158 77.346 25.6011C76.954 25.3864 76.4967 25.2791 75.974 25.2791C75.3953 25.2791 74.882 25.4098 74.434 25.6711C73.986 25.9324 73.636 26.3058 73.384 26.7911C73.132 27.2764 73.006 27.8364 73.006 28.4711C73.006 29.1244 73.132 29.6938 73.384 30.1791C73.6453 30.6644 74.0047 31.0378 74.462 31.2991C74.9193 31.5604 75.4513 31.6911 76.058 31.6911C76.8047 31.6911 77.416 31.4951 77.892 31.1031C78.368 30.7018 78.6807 30.1464 78.83 29.4371H75.47V27.9391H80.762V29.6471C80.6313 30.3284 80.3513 30.9584 79.922 31.5371C79.4927 32.1158 78.9373 32.5824 78.256 32.9371C77.584 33.2824 76.828 33.4551 75.988 33.4551C75.0453 33.4551 74.1913 33.2451 73.426 32.8251C72.67 32.3958 72.0727 31.8031 71.634 31.0471C71.2047 30.2911 70.99 29.4324 70.99 28.4711C70.99 27.5098 71.2047 26.6511 71.634 25.8951C72.0727 25.1298 72.67 24.5371 73.426 24.1171C74.1913 23.6878 75.0407 23.4731 75.974 23.4731C77.0753 23.4731 78.032 23.7438 78.844 24.2851C79.656 24.8171 80.216 25.5684 80.524 26.5391H78.27ZM85.7561 33.4971C85.0094 33.4971 84.3374 33.3338 83.7401 33.0071C83.1428 32.6711 82.6714 32.1998 82.3261 31.5931C81.9901 30.9864 81.8221 30.2864 81.8221 29.4931C81.8221 28.6998 81.9948 27.9998 82.3401 27.3931C82.6948 26.7864 83.1754 26.3198 83.7821 25.9931C84.3888 25.6571 85.0654 25.4891 85.8121 25.4891C86.5588 25.4891 87.2354 25.6571 87.8421 25.9931C88.4488 26.3198 88.9248 26.7864 89.2701 27.3931C89.6248 27.9998 89.8021 28.6998 89.8021 29.4931C89.8021 30.2864 89.6201 30.9864 89.2561 31.5931C88.9014 32.1998 88.4161 32.6711 87.8001 33.0071C87.1934 33.3338 86.5121 33.4971 85.7561 33.4971ZM85.7561 31.7891C86.1108 31.7891 86.4421 31.7051 86.7501 31.5371C87.0674 31.3598 87.3194 31.0984 87.5061 30.7531C87.6928 30.4078 87.7861 29.9878 87.7861 29.4931C87.7861 28.7558 87.5901 28.1911 87.1981 27.7991C86.8154 27.3978 86.3441 27.1971 85.7841 27.1971C85.2241 27.1971 84.7528 27.3978 84.3701 27.7991C83.9968 28.1911 83.8101 28.7558 83.8101 29.4931C83.8101 30.2304 83.9921 30.7998 84.3561 31.2011C84.7294 31.5931 85.1961 31.7891 85.7561 31.7891ZM94.7838 33.4971C94.0372 33.4971 93.3652 33.3338 92.7678 33.0071C92.1705 32.6711 91.6992 32.1998 91.3538 31.5931C91.0178 30.9864 90.8498 30.2864 90.8498 29.4931C90.8498 28.6998 91.0225 27.9998 91.3678 27.3931C91.7225 26.7864 92.2032 26.3198 92.8098 25.9931C93.4165 25.6571 94.0932 25.4891 94.8398 25.4891C95.5865 25.4891 96.2632 25.6571 96.8698 25.9931C97.4765 26.3198 97.9525 26.7864 98.2978 27.3931C98.6525 27.9998 98.8298 28.6998 98.8298 29.4931C98.8298 30.2864 98.6478 30.9864 98.2838 31.5931C97.9292 32.1998 97.4438 32.6711 96.8278 33.0071C96.2212 33.3338 95.5398 33.4971 94.7838 33.4971ZM94.7838 31.7891C95.1385 31.7891 95.4698 31.7051 95.7778 31.5371C96.0952 31.3598 96.3472 31.0984 96.5338 30.7531C96.7205 30.4078 96.8138 29.9878 96.8138 29.4931C96.8138 28.7558 96.6178 28.1911 96.2258 27.7991C95.8432 27.3978 95.3718 27.1971 94.8118 27.1971C94.2518 27.1971 93.7805 27.3978 93.3978 27.7991C93.0245 28.1911 92.8378 28.7558 92.8378 29.4931C92.8378 30.2304 93.0198 30.7998 93.3838 31.2011C93.7572 31.5931 94.2238 31.7891 94.7838 31.7891ZM103.406 25.4891C103.984 25.4891 104.493 25.6058 104.932 25.8391C105.37 26.0631 105.716 26.3571 105.968 26.7211V25.6151H107.942V33.4271C107.942 34.1458 107.797 34.7851 107.508 35.3451C107.218 35.9144 106.784 36.3624 106.206 36.6891C105.627 37.0251 104.927 37.1931 104.106 37.1931C103.004 37.1931 102.099 36.9364 101.39 36.4231C100.69 35.9098 100.293 35.2098 100.2 34.3231H102.146C102.248 34.6778 102.468 34.9578 102.804 35.1631C103.149 35.3778 103.564 35.4851 104.05 35.4851C104.619 35.4851 105.081 35.3124 105.436 34.9671C105.79 34.6311 105.968 34.1178 105.968 33.4271V32.2231C105.716 32.5871 105.366 32.8904 104.918 33.1331C104.479 33.3758 103.975 33.4971 103.406 33.4971C102.752 33.4971 102.155 33.3291 101.614 32.9931C101.072 32.6571 100.643 32.1858 100.326 31.5791C100.018 30.9631 99.8636 30.2584 99.8636 29.4651C99.8636 28.6811 100.018 27.9858 100.326 27.3791C100.643 26.7724 101.068 26.3058 101.6 25.9791C102.141 25.6524 102.743 25.4891 103.406 25.4891ZM105.968 29.4931C105.968 29.0171 105.874 28.6111 105.688 28.2751C105.501 27.9298 105.249 27.6684 104.932 27.4911C104.614 27.3044 104.274 27.2111 103.91 27.2111C103.546 27.2111 103.21 27.2998 102.902 27.4771C102.594 27.6544 102.342 27.9158 102.146 28.2611C101.959 28.5971 101.866 28.9984 101.866 29.4651C101.866 29.9318 101.959 30.3424 102.146 30.6971C102.342 31.0424 102.594 31.3084 102.902 31.4951C103.219 31.6818 103.555 31.7751 103.91 31.7751C104.274 31.7751 104.614 31.6864 104.932 31.5091C105.249 31.3224 105.501 31.0611 105.688 30.7251C105.874 30.3798 105.968 29.9691 105.968 29.4931ZM111.916 23.0111V33.3711H109.956V23.0111H111.916ZM121.162 29.3251C121.162 29.6051 121.144 29.8571 121.106 30.0811H115.436C115.483 30.6411 115.679 31.0798 116.024 31.3971C116.37 31.7144 116.794 31.8731 117.298 31.8731C118.026 31.8731 118.544 31.5604 118.852 30.9351H120.966C120.742 31.6818 120.313 32.2978 119.678 32.7831C119.044 33.2591 118.264 33.4971 117.34 33.4971C116.594 33.4971 115.922 33.3338 115.324 33.0071C114.736 32.6711 114.274 32.1998 113.938 31.5931C113.612 30.9864 113.448 30.2864 113.448 29.4931C113.448 28.6904 113.612 27.9858 113.938 27.3791C114.265 26.7724 114.722 26.3058 115.31 25.9791C115.898 25.6524 116.575 25.4891 117.34 25.4891C118.078 25.4891 118.736 25.6478 119.314 25.9651C119.902 26.2824 120.355 26.7351 120.672 27.3231C120.999 27.9018 121.162 28.5691 121.162 29.3251ZM119.132 28.7651C119.123 28.2611 118.941 27.8598 118.586 27.5611C118.232 27.2531 117.798 27.0991 117.284 27.0991C116.799 27.0991 116.388 27.2484 116.052 27.5471C115.726 27.8364 115.525 28.2424 115.45 28.7651H119.132Z" fill="#171725" />
            <path d="M50.1 31.8622C50.1 30.4959 49.9897 29.4988 49.751 28.4648H34.2308V34.6318H43.3408C43.1572 36.1643 42.1654 38.4723 39.9613 40.0232L39.9304 40.2297L44.8376 44.0513L45.1776 44.0854C48.2999 41.1865 50.1 36.9213 50.1 31.8622Z" fill="#4285F4" />
            <path d="M34.2308 48.1103C38.6939 48.1103 42.4407 46.6331 45.1775 44.0852L39.9613 40.023C38.5654 41.0016 36.6919 41.6847 34.2308 41.6847C29.8594 41.6847 26.1493 38.786 24.8268 34.7793L24.6329 34.7958L19.5303 38.7656L19.4636 38.9521C22.1819 44.3805 27.7655 48.1103 34.2308 48.1103Z" fill="#34A853" />
            <path d="M24.8263 34.7801C24.4774 33.7461 24.2754 32.6382 24.2754 31.4935C24.2754 30.3487 24.4774 29.2409 24.808 28.2069L24.7987 27.9867L19.6322 23.9531L19.4632 24.034C18.3428 26.2866 17.7 28.8162 17.7 31.4935C17.7 34.1708 18.3428 36.7003 19.4632 38.9529L24.8263 34.7801Z" fill="#FBBC05" />
            <path d="M34.2308 21.3004C37.3348 21.3004 39.4286 22.6483 40.6225 23.7747L45.2877 19.1956C42.4225 16.5183 38.6939 14.875 34.2308 14.875C27.7655 14.875 22.1819 18.6047 19.4636 24.0331L24.8084 28.206C26.1493 24.1993 29.8594 21.3004 34.2308 21.3004Z" fill="#EB4335" />
          </svg>
        </button>

        <button>
          <svg width="176" height="63" viewBox="0 0 176 63" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.09998 9.60548C1.09998 5.1872 4.6817 1.60547 9.09998 1.60547H167.1C171.518 1.60547 175.1 5.18719 175.1 9.60547V53.9222C175.1 58.3404 171.518 61.9222 167.1 61.9222H9.09997C4.68169 61.9222 1.09998 58.3405 1.09998 53.9222V9.60548Z" fill="white" stroke="#E0E2E9" stroke-width="1.60375" />
            <path d="M77.7 23.5991V25.1811H73.626V27.6871H76.748V29.2411H73.626V33.3711H71.666V23.5991H77.7ZM78.6858 29.4651C78.6858 28.6811 78.8398 27.9858 79.1478 27.3791C79.4651 26.7724 79.8898 26.3058 80.4218 25.9791C80.9631 25.6524 81.5651 25.4891 82.2278 25.4891C82.8064 25.4891 83.3104 25.6058 83.7398 25.8391C84.1784 26.0724 84.5284 26.3664 84.7898 26.7211V25.6151H86.7638V33.3711H84.7898V32.2371C84.5378 32.6011 84.1878 32.9044 83.7398 33.1471C83.3011 33.3804 82.7924 33.4971 82.2138 33.4971C81.5604 33.4971 80.9631 33.3291 80.4218 32.9931C79.8898 32.6571 79.4651 32.1858 79.1478 31.5791C78.8398 30.9631 78.6858 30.2584 78.6858 29.4651ZM84.7898 29.4931C84.7898 29.0171 84.6964 28.6111 84.5098 28.2751C84.3231 27.9298 84.0711 27.6684 83.7538 27.4911C83.4364 27.3044 83.0958 27.2111 82.7318 27.2111C82.3678 27.2111 82.0318 27.2998 81.7238 27.4771C81.4158 27.6544 81.1638 27.9158 80.9678 28.2611C80.7811 28.5971 80.6878 28.9984 80.6878 29.4651C80.6878 29.9318 80.7811 30.3424 80.9678 30.6971C81.1638 31.0424 81.4158 31.3084 81.7238 31.4951C82.0411 31.6818 82.3771 31.7751 82.7318 31.7751C83.0958 31.7751 83.4364 31.6864 83.7538 31.5091C84.0711 31.3224 84.3231 31.0611 84.5098 30.7251C84.6964 30.3798 84.7898 29.9691 84.7898 29.4931ZM88.2741 29.4931C88.2741 28.6904 88.4374 27.9904 88.7641 27.3931C89.0907 26.7864 89.5434 26.3198 90.1221 25.9931C90.7007 25.6571 91.3634 25.4891 92.1101 25.4891C93.0714 25.4891 93.8647 25.7318 94.4901 26.2171C95.1247 26.6931 95.5494 27.3651 95.7641 28.2331H93.6501C93.5381 27.8971 93.3467 27.6358 93.0761 27.4491C92.8147 27.2531 92.4881 27.1551 92.0961 27.1551C91.5361 27.1551 91.0927 27.3604 90.7661 27.7711C90.4394 28.1724 90.2761 28.7464 90.2761 29.4931C90.2761 30.2304 90.4394 30.8044 90.7661 31.2151C91.0927 31.6164 91.5361 31.8171 92.0961 31.8171C92.8894 31.8171 93.4074 31.4624 93.6501 30.7531H95.7641C95.5494 31.5931 95.1247 32.2604 94.4901 32.7551C93.8554 33.2498 93.0621 33.4971 92.1101 33.4971C91.3634 33.4971 90.7007 33.3338 90.1221 33.0071C89.5434 32.6711 89.0907 32.2044 88.7641 31.6071C88.4374 31.0004 88.2741 30.2958 88.2741 29.4931ZM104.51 29.3251C104.51 29.6051 104.491 29.8571 104.454 30.0811H98.7839C98.8306 30.6411 99.0266 31.0798 99.3719 31.3971C99.7173 31.7144 100.142 31.8731 100.646 31.8731C101.374 31.8731 101.892 31.5604 102.2 30.9351H104.314C104.09 31.6818 103.661 32.2978 103.026 32.7831C102.391 33.2591 101.612 33.4971 100.688 33.4971C99.9413 33.4971 99.2693 33.3338 98.6719 33.0071C98.0839 32.6711 97.6219 32.1998 97.2859 31.5931C96.9593 30.9864 96.7959 30.2864 96.7959 29.4931C96.7959 28.6904 96.9593 27.9858 97.2859 27.3791C97.6126 26.7724 98.0699 26.3058 98.6579 25.9791C99.2459 25.6524 99.9226 25.4891 100.688 25.4891C101.425 25.4891 102.083 25.6478 102.662 25.9651C103.25 26.2824 103.703 26.7351 104.02 27.3231C104.347 27.9018 104.51 28.5691 104.51 29.3251ZM102.48 28.7651C102.471 28.2611 102.289 27.8598 101.934 27.5611C101.579 27.2531 101.145 27.0991 100.632 27.0991C100.147 27.0991 99.7359 27.2484 99.3999 27.5471C99.0733 27.8364 98.8726 28.2424 98.7979 28.7651H102.48ZM108.001 26.7491C108.253 26.3758 108.598 26.0724 109.037 25.8391C109.485 25.6058 109.993 25.4891 110.563 25.4891C111.225 25.4891 111.823 25.6524 112.355 25.9791C112.896 26.3058 113.321 26.7724 113.629 27.3791C113.946 27.9764 114.105 28.6718 114.105 29.4651C114.105 30.2584 113.946 30.9631 113.629 31.5791C113.321 32.1858 112.896 32.6571 112.355 32.9931C111.823 33.3291 111.225 33.4971 110.563 33.4971C109.984 33.4971 109.475 33.3851 109.037 33.1611C108.607 32.9278 108.262 32.6291 108.001 32.2651V33.3711H106.041V23.0111H108.001V26.7491ZM112.103 29.4651C112.103 28.9984 112.005 28.5971 111.809 28.2611C111.622 27.9158 111.37 27.6544 111.053 27.4771C110.745 27.2998 110.409 27.2111 110.045 27.2111C109.69 27.2111 109.354 27.3044 109.037 27.4911C108.729 27.6684 108.477 27.9298 108.281 28.2751C108.094 28.6204 108.001 29.0264 108.001 29.4931C108.001 29.9598 108.094 30.3658 108.281 30.7111C108.477 31.0564 108.729 31.3224 109.037 31.5091C109.354 31.6864 109.69 31.7751 110.045 31.7751C110.409 31.7751 110.745 31.6818 111.053 31.4951C111.37 31.3084 111.622 31.0424 111.809 30.6971C112.005 30.3518 112.103 29.9411 112.103 29.4651ZM119.073 33.4971C118.326 33.4971 117.654 33.3338 117.057 33.0071C116.46 32.6711 115.988 32.1998 115.643 31.5931C115.307 30.9864 115.139 30.2864 115.139 29.4931C115.139 28.6998 115.312 27.9998 115.657 27.3931C116.012 26.7864 116.492 26.3198 117.099 25.9931C117.706 25.6571 118.382 25.4891 119.129 25.4891C119.876 25.4891 120.552 25.6571 121.159 25.9931C121.766 26.3198 122.242 26.7864 122.587 27.3931C122.942 27.9998 123.119 28.6998 123.119 29.4931C123.119 30.2864 122.937 30.9864 122.573 31.5931C122.218 32.1998 121.733 32.6711 121.117 33.0071C120.51 33.3338 119.829 33.4971 119.073 33.4971ZM119.073 31.7891C119.428 31.7891 119.759 31.7051 120.067 31.5371C120.384 31.3598 120.636 31.0984 120.823 30.7531C121.01 30.4078 121.103 29.9878 121.103 29.4931C121.103 28.7558 120.907 28.1911 120.515 27.7991C120.132 27.3978 119.661 27.1971 119.101 27.1971C118.541 27.1971 118.07 27.3978 117.687 27.7991C117.314 28.1911 117.127 28.7558 117.127 29.4931C117.127 30.2304 117.309 30.7998 117.673 31.2011C118.046 31.5931 118.513 31.7891 119.073 31.7891ZM128.101 33.4971C127.354 33.4971 126.682 33.3338 126.085 33.0071C125.487 32.6711 125.016 32.1998 124.671 31.5931C124.335 30.9864 124.167 30.2864 124.167 29.4931C124.167 28.6998 124.339 27.9998 124.685 27.3931C125.039 26.7864 125.52 26.3198 126.127 25.9931C126.733 25.6571 127.41 25.4891 128.157 25.4891C128.903 25.4891 129.58 25.6571 130.187 25.9931C130.793 26.3198 131.269 26.7864 131.615 27.3931C131.969 27.9998 132.147 28.6998 132.147 29.4931C132.147 30.2864 131.965 30.9864 131.601 31.5931C131.246 32.1998 130.761 32.6711 130.145 33.0071C129.538 33.3338 128.857 33.4971 128.101 33.4971ZM128.101 31.7891C128.455 31.7891 128.787 31.7051 129.095 31.5371C129.412 31.3598 129.664 31.0984 129.851 30.7531C130.037 30.4078 130.131 29.9878 130.131 29.4931C130.131 28.7558 129.935 28.1911 129.543 27.7991C129.16 27.3978 128.689 27.1971 128.129 27.1971C127.569 27.1971 127.097 27.3978 126.715 27.7991C126.341 28.1911 126.155 28.7558 126.155 29.4931C126.155 30.2304 126.337 30.7998 126.701 31.2011C127.074 31.5931 127.541 31.7891 128.101 31.7891ZM138.276 33.3711L135.644 30.0671V33.3711H133.684V23.0111H135.644V28.9051L138.248 25.6151H140.796L137.38 29.5071L140.824 33.3711H138.276Z" fill="#171725" />
            <path d="M52.7 31.1598C52.7 21.4986 44.9105 13.668 35.3 13.668C25.6894 13.668 17.9 21.4986 17.9 31.1598C17.9 39.8914 24.2593 47.1277 32.5827 48.4408V36.2205H28.1683V31.1598H32.5827V27.3068C32.5827 22.9267 35.176 20.5018 39.1518 20.5018C41.0586 20.5018 43.0513 20.8468 43.0513 20.8468V25.1503H40.8584C38.6942 25.1503 38.0268 26.5017 38.0268 27.8819V31.1598H42.8511L42.0788 36.2205H38.0268V48.4408C46.3406 47.1277 52.7 39.8914 52.7 31.1598Z" fill="#1877F2" />
            <path d="M42.0689 36.2206L42.8411 31.16H38.0168V27.8821C38.0168 26.5019 38.6937 25.1505 40.8485 25.1505H43.0413V20.847C43.0413 20.847 41.0487 20.502 39.1418 20.502C35.1661 20.502 32.5727 22.9268 32.5727 27.307V31.16H28.1584V36.2206H32.5727V48.441C33.4594 48.5847 34.3652 48.6518 35.29 48.6518C36.2148 48.6518 37.1206 48.5752 38.0073 48.441V36.2206H42.0689Z" fill="white" />
          </svg>
        </button>

      </div>
      <p className={classes['no-account']}>
        <a href="">Немає особистого кабінету? <NavLink to="/signup">Зареєструватись</NavLink></a>
      </p>
    </div>
  );
};

export default LoginForm;